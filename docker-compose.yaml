services:
    prometheus:
        image: prom/prometheus
        container_name: prometheus
        command:
            - "--config.file=/etc/prometheus/prometheus.yml"
        ports:
            - 9090:9090
        restart: unless-stopped
        volumes:
            - ./prometheus:/etc/prometheus
            - prom_data:/prometheus
        depends_on:
            - mongodb_exporter

    grafana:
        image: grafana/grafana
        container_name: grafana
        ports:
            - ${GF_SERVER_HTTP_PORT}:${GF_SERVER_HTTP_PORT}
        restart: unless-stopped
        environment:
            - GF_SERVER_HTTP_PORT=${GF_SERVER_HTTP_PORT}
            - GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER}
            - GF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD}
        volumes:
            - ./grafana:/etc/grafana/provisioning/datasources

    mongodb_exporter:
        image: percona/mongodb_exporter:0.20
        container_name: mongodb_exporter
        ports:
            - 9216:9216
        command:
            - "--mongodb.uri=mongodb://10.130.227.200:30001"
        restart: unless-stopped

volumes:
    prom_data:
